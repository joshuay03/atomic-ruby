<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  Class: AtomicRuby::Atom
  
    &mdash; Documentation by YARD 0.9.38
  
</title>

  <link rel="stylesheet" href="../css/style.css" type="text/css" />

  <link rel="stylesheet" href="../css/common.css" type="text/css" />

<script type="text/javascript">
  pathId = "AtomicRuby::Atom";
  relpath = '../';
</script>


  <script type="text/javascript" charset="utf-8" src="../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="../class_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="../_index.html">Index (A)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../AtomicRuby.html" title="AtomicRuby (module)">AtomicRuby</a></span></span>
     &raquo; 
    <span class="title">Atom</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><h1>Class: AtomicRuby::Atom
  
  
  
</h1>
<div class="box_info">
  
  <dl>
    <dt>Inherits:</dt>
    <dd>
      <span class="inheritName">Object</span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next">AtomicRuby::Atom</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
    </dd>
  </dl>
  

  
  
  
  
  

  

  
  <dl>
    <dt>Defined in:</dt>
    <dd>lib/atomic-ruby/atom.rb<span class="defines">,<br />
  ext/atomic_ruby/atomic_ruby.c</span>
</dd>
  </dl>
  
</div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    
  <div class="note notetag">
    <strong>Note:</strong>
    <div class='inline'>
<p>This class is Ractor-safe in Ruby 4.0+ when compiled with ractor support. Values that cross ractor boundaries are automatically made shareable.</p>
</div>
  </div>


<p>Provides atomic reference semantics using Compare-And-Swap (CAS) operations.</p>

<p>An Atom allows for lock-free, thread-safe updates to a single reference value. The core operation is <span class='object_link'><a href="#swap-instance_method" title="AtomicRuby::Atom#swap (method)">#swap</a></span>, which atomically updates the value based on the current value, retrying if another thread modifies it concurrently.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <h4 class="tag_title">Examples:</h4>
    
      
        <h5 class="example_title"><div class='inline'>
<p>Basic usage</p>
</div></h5>
      
      <pre class="example code"><code><span class='id identifier rubyid_atom'>atom</span> <span class='op'>=</span> <span class='const'>Atom</span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="#initialize-instance_method" title="AtomicRuby::Atom#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='int'>0</span><span class='rparen'>)</span>
<span class='id identifier rubyid_atom'>atom</span><span class='period'>.</span><span class='id identifier rubyid_swap'>swap</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_current_value'>current_value</span><span class='op'>|</span> <span class='id identifier rubyid_current_value'>current_value</span> <span class='op'>+</span> <span class='int'>1</span> <span class='rbrace'>}</span>
<span class='id identifier rubyid_puts'>puts</span> <span class='id identifier rubyid_atom'>atom</span><span class='period'>.</span><span class='id identifier rubyid_value'>value</span> <span class='comment'>#=&gt; 1</span></code></pre>
    
      
        <h5 class="example_title"><div class='inline'>
<p>Thread-safe counter</p>
</div></h5>
      
      <pre class="example code"><code><span class='id identifier rubyid_counter'>counter</span> <span class='op'>=</span> <span class='const'>Atom</span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="#initialize-instance_method" title="AtomicRuby::Atom#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='int'>0</span><span class='rparen'>)</span>
<span class='id identifier rubyid_threads'>threads</span> <span class='op'>=</span> <span class='int'>10</span><span class='period'>.</span><span class='id identifier rubyid_times'>times</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='kw'>do</span>
  <span class='const'>Thread</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span> <span class='lbrace'>{</span> <span class='int'>100</span><span class='period'>.</span><span class='id identifier rubyid_times'>times</span> <span class='lbrace'>{</span> <span class='id identifier rubyid_counter'>counter</span><span class='period'>.</span><span class='id identifier rubyid_swap'>swap</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_current_count'>current_count</span><span class='op'>|</span> <span class='id identifier rubyid_current_count'>current_count</span> <span class='op'>+</span> <span class='int'>1</span> <span class='rbrace'>}</span> <span class='rbrace'>}</span> <span class='rbrace'>}</span>
<span class='kw'>end</span>
<span class='id identifier rubyid_threads'>threads</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='symbol'>:join</span><span class='rparen'>)</span>
<span class='id identifier rubyid_puts'>puts</span> <span class='id identifier rubyid_counter'>counter</span><span class='period'>.</span><span class='id identifier rubyid_value'>value</span> <span class='comment'>#=&gt; 1000</span></code></pre>
    
      
        <h5 class="example_title"><div class='inline'>
<p>Non-mutating array operations</p>
</div></h5>
      
      <pre class="example code"><code><span class='id identifier rubyid_atom'>atom</span> <span class='op'>=</span> <span class='const'>Atom</span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="#initialize-instance_method" title="AtomicRuby::Atom#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='lbracket'>[</span><span class='rbracket'>]</span><span class='rparen'>)</span>
<span class='id identifier rubyid_atom'>atom</span><span class='period'>.</span><span class='id identifier rubyid_swap'>swap</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_current_array'>current_array</span><span class='op'>|</span> <span class='id identifier rubyid_current_array'>current_array</span> <span class='op'>+</span> <span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span> <span class='rbrace'>}</span>
<span class='id identifier rubyid_atom'>atom</span><span class='period'>.</span><span class='id identifier rubyid_swap'>swap</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_current_array'>current_array</span><span class='op'>|</span> <span class='id identifier rubyid_current_array'>current_array</span> <span class='op'>+</span> <span class='lbracket'>[</span><span class='int'>2</span><span class='rbracket'>]</span> <span class='rbrace'>}</span>
<span class='id identifier rubyid_puts'>puts</span> <span class='id identifier rubyid_atom'>atom</span><span class='period'>.</span><span class='id identifier rubyid_value'>value</span> <span class='comment'>#=&gt; [1, 2]</span></code></pre>
    
  </div>


</div>






  
    <h2>
      Instance Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#initialize-instance_method" title="#initialize (instance method)">#<strong>initialize</strong>(value)  &#x21d2; Atom </a>
    

    
  </span>
  
  
    <span class="note title constructor">constructor</span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Creates a new atomic reference with the given initial value.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#swap-instance_method" title="#swap (instance method)">#<strong>swap</strong> {|current_value| ... } &#x21d2; untyped </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Atomically updates the value using a compare-and-swap operation.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#value-instance_method" title="#value (instance method)">#<strong>value</strong>  &#x21d2; untyped </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns the current value stored in the atom.</p>
</div></span>
  
</li>

      
    </ul>
  

<div id="constructor_details" class="method_details_list">
  <h2>Constructor Details</h2>
  
    <div class="method_details first">
  <h3 class="signature first" id="initialize-instance_method">
  
    #<strong>initialize</strong>(value)  &#x21d2; <tt><span class='object_link'><a href="" title="AtomicRuby::Atom (class)">Atom</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Creates a new atomic reference with the given initial value.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <h4 class="tag_title">Examples:</h4>
    
      
      <pre class="example code"><code><span class='id identifier rubyid_atom'>atom</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="" title="AtomicRuby::Atom (class)">Atom</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='int'>42</span><span class='rparen'>)</span>
<span class='id identifier rubyid_atom'>atom</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="" title="AtomicRuby::Atom (class)">Atom</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='lbracket'>[</span><span class='int'>1</span><span class='comma'>,</span> <span class='int'>2</span><span class='comma'>,</span> <span class='int'>3</span><span class='rbracket'>]</span><span class='rparen'>)</span>
<span class='id identifier rubyid_atom'>atom</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="" title="AtomicRuby::Atom (class)">Atom</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='lbrace'>{</span> <span class='label'>key:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>value</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span><span class='rparen'>)</span></code></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>value</span>
      
      
        <span class='type'>(<tt>untyped</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The initial value to store atomically</p>
</div>
      
    </li>
  
</ul>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


45
46
47</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/atomic-ruby/atom.rb', line 45</span>

<span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span><span class='lparen'>(</span><span class='id identifier rubyid_value'>value</span><span class='rparen'>)</span>
  <span class='id identifier rubyid__initialize'>_initialize</span><span class='lparen'>(</span><span class='id identifier rubyid_value'>value</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
  
</div>


  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="swap-instance_method">
  
    #<strong>swap</strong> {|current_value| ... } &#x21d2; <tt>untyped</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Atomically updates the value using a compare-and-swap operation.</p>

<p>The block receives the current value and must return the new value. If another thread modifies the atom between reading the current value and attempting to update it, the operation retries with the new current value.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <h4 class="tag_title">Examples:</h4>
    
      
        <h5 class="example_title"><div class='inline'>
<p>Increment a counter</p>
</div></h5>
      
      <pre class="example code"><code><span class='id identifier rubyid_atom'>atom</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="" title="AtomicRuby::Atom (class)">Atom</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="#initialize-instance_method" title="AtomicRuby::Atom#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='int'>0</span><span class='rparen'>)</span>
<span class='id identifier rubyid_new_value'>new_value</span> <span class='op'>=</span> <span class='id identifier rubyid_atom'>atom</span><span class='period'>.</span><span class='id identifier rubyid_swap'>swap</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_current_value'>current_value</span><span class='op'>|</span> <span class='id identifier rubyid_current_value'>current_value</span> <span class='op'>+</span> <span class='int'>1</span> <span class='rbrace'>}</span>
<span class='id identifier rubyid_puts'>puts</span> <span class='id identifier rubyid_new_value'>new_value</span> <span class='comment'>#=&gt; 1</span></code></pre>
    
      
        <h5 class="example_title"><div class='inline'>
<p>Append to array (non-mutating)</p>
</div></h5>
      
      <pre class="example code"><code><span class='id identifier rubyid_atom'>atom</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="" title="AtomicRuby::Atom (class)">Atom</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="#initialize-instance_method" title="AtomicRuby::Atom#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='lbracket'>[</span><span class='int'>1</span><span class='comma'>,</span> <span class='int'>2</span><span class='rbracket'>]</span><span class='rparen'>)</span>
<span class='id identifier rubyid_atom'>atom</span><span class='period'>.</span><span class='id identifier rubyid_swap'>swap</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_current_array'>current_array</span><span class='op'>|</span> <span class='id identifier rubyid_current_array'>current_array</span> <span class='op'>+</span> <span class='lbracket'>[</span><span class='int'>3</span><span class='rbracket'>]</span> <span class='rbrace'>}</span>
<span class='id identifier rubyid_puts'>puts</span> <span class='id identifier rubyid_atom'>atom</span><span class='period'>.</span><span class='id identifier rubyid_value'>value</span> <span class='comment'>#=&gt; [1, 2, 3]</span></code></pre>
    
      
        <h5 class="example_title"><div class='inline'>
<p>Conditional update</p>
</div></h5>
      
      <pre class="example code"><code><span class='id identifier rubyid_atom'>atom</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="" title="AtomicRuby::Atom (class)">Atom</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="#initialize-instance_method" title="AtomicRuby::Atom#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='int'>10</span><span class='rparen'>)</span>
<span class='id identifier rubyid_atom'>atom</span><span class='period'>.</span><span class='id identifier rubyid_swap'>swap</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_current_value'>current_value</span><span class='op'>|</span> <span class='id identifier rubyid_current_value'>current_value</span> <span class='op'>&gt;</span> <span class='int'>5</span> <span class='op'>?</span> <span class='id identifier rubyid_current_value'>current_value</span> <span class='op'>*</span> <span class='int'>2</span> <span class='op'>:</span> <span class='id identifier rubyid_current_value'>current_value</span> <span class='rbrace'>}</span>
<span class='id identifier rubyid_puts'>puts</span> <span class='id identifier rubyid_atom'>atom</span><span class='period'>.</span><span class='id identifier rubyid_value'>value</span> <span class='comment'>#=&gt; 20</span></code></pre>
    
  </div>

<p class="tag_title">Yield Parameters:</p>
<ul class="yieldparam">
  
    <li>
      
        <span class='name'>current_value</span>
      
      
        <span class='type'>(<tt>untyped</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The current atomic value</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Yield Returns:</p>
<ul class="yieldreturn">
  
    <li>
      
      
        <span class='type'>(<tt>untyped</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The new value to store atomically</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>untyped</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The new value that was successfully stored</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


92
93
94
95
96</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/atomic-ruby/atom.rb', line 92</span>

<span class='kw'>def</span> <span class='id identifier rubyid_swap'>swap</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
  <span class='id identifier rubyid__swap'>_swap</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_old_value'>old_value</span><span class='op'>|</span>
    <span class='id identifier rubyid_make_shareable_if_needed'>make_shareable_if_needed</span><span class='lparen'>(</span><span class='id identifier rubyid_block'>block</span><span class='period'>.</span><span class='id identifier rubyid_call'>call</span><span class='lparen'>(</span><span class='id identifier rubyid_old_value'>old_value</span><span class='rparen'>)</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="value-instance_method">
  
    #<strong>value</strong>  &#x21d2; <tt>untyped</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns the current value stored in the atom.</p>

<p>This operation is atomic and thread-safe. The returned value reflects the state at the time of the call, but may change immediately after in concurrent environments.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <h4 class="tag_title">Examples:</h4>
    
      
      <pre class="example code"><code><span class='id identifier rubyid_atom'>atom</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="" title="AtomicRuby::Atom (class)">Atom</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="#initialize-instance_method" title="AtomicRuby::Atom#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>hello</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
<span class='id identifier rubyid_puts'>puts</span> <span class='id identifier rubyid_atom'>atom</span><span class='period'>.</span><span class='id identifier rubyid_value'>value</span> <span class='comment'>#=&gt; &quot;hello&quot;</span></code></pre>
    
  </div>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>untyped</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The current atomic value</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


62
63
64</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/atomic-ruby/atom.rb', line 62</span>

<span class='kw'>def</span> <span class='id identifier rubyid_value'>value</span>
  <span class='id identifier rubyid__value'>_value</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

      <div id="footer">
  Generated on Sat Jan 17 05:28:11 2026 by
  <a href="https://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.38 (ruby-4.1.0).
</div>

    </div>
  </body>
</html>